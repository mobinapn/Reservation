<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ event.place }}</title>
</head>
<body>
    <h1>{{ event.place }}</h1>
    <p>{{ event.details }}</p>
    <p>{{ event.begin_date }} to {{ event.end_date }}</p>
    <p>Price: {{ event.price }}</p>

    <h2>Comments</h2>
    <div id="comments">
        {% for comment in comments %}
            <div>
                <strong>{{ comment.user.username }}</strong>:
                <p>{{ comment.content }}</p>
                
                <!-- Edit/Delete buttons only visible for the comment owner -->
                {% if comment.user_id == current_user.id %}
                    <a href="{{ url_for('update_comment', comment_id=comment.id) }}">Edit</a>
                    <form action="{{ url_for('delete_comment', comment_id=comment.id) }}" method="POST" style="display:inline;">
                        {{ form.csrf_token }}
                        <button type="submit" onclick="return confirm('Are you sure you want to delete this comment?')">Delete</button>
                    </form>
                {% endif %}
                
                <!-- Show replies -->
                {% for reply in comment.replies %}
                    <div style="margin-left: 20px;">
                        <strong>{{ reply.user.username }}</strong>:
                        <p>{{ reply.content }}</p>
                    </div>
                {% endfor %}

                <!-- Reply to this comment -->
                <a href="#" onclick="document.getElementById('parent_id').value = {{ comment.id }}">Reply</a>
            </div>
        {% endfor %}
    </div>

    {% if current_user.is_authenticated %}
        <h3>Add a Comment</h3>
        <form method="POST" action="">
            {{ comment_form.csrf_token }}
            {{ comment_form.content.label }} {{ comment_form.content() }}
            {{ comment_form.parent_id() }}
            {{ comment_form.submit() }}
        </form>
    {% else %}
        <p>You must be logged in to add a comment. <a href="{{ url_for('login') }}">Login here</a>.</p>
    {% endif %}

    <script>
        // Dynamically set parent comment ID for replies
        function setReplyParent(commentId) {
            document.getElementById('parent_id').value = commentId;
        }
    </script>
</body>
</html>




